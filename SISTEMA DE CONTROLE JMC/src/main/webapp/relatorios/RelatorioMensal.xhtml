<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
<ui:composition template="../templates/administrador.xhtml">
  <ui:define name="content">
    <h:form prependId="false" id="growlForm">
      <p:growl id="growl" showDetail="false" />
    </h:form>
    <h:form prependId="false" id="dataForm">       
	<p:commandButton id="anteriorButton" update=":dataForm:field" value="Anterior" action="#{relatorioMesBean.anterior}" />
	<p:commandButton id="proximoButton" update=":dataForm:field" value="Próximo" action="#{relatorioMesBean.proximo}" />
	<p:tooltip for="faturamentoButton" value="#{messages.label_edit}" showEffect="fade" hideEffect="fade" />
	<p:commandButton id="faturamentoButton" icon="ui-icon-calculator" update=":createFaturamentoForm:createPanelFaturamentoGrid" actionListener="#{relatorioMesBean.carregarPeriodo(relatorioMesBean.dataLabel)}" value="Faturamento" oncomplete="PF('createDialogfaturamentoWidget').show()" />	
	<br/><br/>
	<p:fieldset id="field" legend="Relatorio de Desempenho Mensal - #{relatorioMesBean.dataLabel}">
        <p:dataTable id="list" var="linha" value="#{relatorioMesBean.resumos}" >
       	<p:columnGroup type="header">
            <p:row>
            	<p:column width="10"/>
                <p:column width="200"/>
                <p:column width="15"/>
                <p:column width="15"/>
            </p:row>        	
       	</p:columnGroup>        
       	<f:facet name="header" width="1800" >Relatorio de Despenho Mensal</f:facet>
        	<p:subTable var="item" value="#{linha.classificacoes}"  >
        	<f:facet name="header">
        		<h:outputText  value="#{linha.name}" />
        	</f:facet>        	
	        	<p:column >
	                <h:outputText value="#{item.codigo}" />
	        	</p:column>	 
	        	<p:column>
	                <h:outputText value="#{item.name}"/>
	        	</p:column>
	        	<p:column >
	        	<ui:repeat var="total" value="#{item.itens}">
	                <h:outputText value="#{total.campos[relatorioMesBean.ultimoDiaDoMes+1]}" >
	                	<f:convertNumber type ="percent" pattern="###.##" />
	                </h:outputText>
	            </ui:repeat>    
	        	</p:column>
		        	<p:column style="text-align:center">
	        	<ui:repeat var="total" value="#{item.itens}">
		        		<h:outputText value="#{total.campos[relatorioMesBean.ultimoDiaDoMes+2]}">
			        			<f:convertNumber currencyCode="BRL" minIntegerDigits="2" />
		        		</h:outputText>
	        	</ui:repeat>
		        	</p:column> 
        	</p:subTable>	
        	<f:facet name="footer" width="1800">Relatorio de Despenho Mensal</f:facet>          	        	       	       	
        </p:dataTable>
    </p:fieldset>
    </h:form>
    <p:dialog id="createFaturamentoDialog" header="#{messages.label_create} Faturamento" modal="true" widgetVar="createDialogfaturamentoWidget" dynamic="true" resizable="true" maximizable="true" showEffect="fade" hideEffect="explode">
     <h:form id="createFaturamentoForm" acceptcharset="ISO-8859-1" enctype="multipart/form-data">
    	<fieldset>
    		<legend>Futuramento</legend>   	
	          <h:panelGrid id="createPanelFaturamentoGrid" columns="3" styleClass="dialog">
	          
	          	<p:outputLabel value="Mês/Ano" for="mesDoAno"/>
				<p:calendar 
					id="mesDoAno"
					value="#{relatorioMesBean.faturamento.periodo}"
					pattern="MM/yyyy" 
					required="true"
					requiredMessage="O valor é obrigatório"	
					disabled="true"
					/>        	
	          	<p:message for="mesDoAno"/>          
	          
	          	<p:outputLabel value="Valor Faturamento Bruto" for="valorBruto"/>
	          	<p:inputText 
	          		id="valorBruto"
	          		styleClass="money" 
	          		value="#{relatorioMesBean.faturamento.faturamentoBruto}"
	          		requiredMessage="O valor é obrigatório"
	          		required="true"
	          		/>
	          	<p:message for="valorBruto"/>
	          
	          	<p:outputLabel value="  Valor Taxas de Entrega" for="valorEntrega"/>
	          	<p:inputText 
	          		id="valorEntrega"
	          		styleClass="money" 
	          		value="#{relatorioMesBean.faturamento.taxaEntrega}"
	          		disabled="true"
	          		/>
	          	<p:message for="valorEntrega"/>  
	          
	          	<p:outputLabel value="Valor Serviço de Mesa" for="valorServico"/>
	          	<p:inputText 
	          		id="valorServico"
	          		styleClass="money" 
	          		value="#{relatorioMesBean.faturamento.servicoMesa}"
	          		disabled="true"
	          		/>
	          	<p:message for="valorServico"/>
	          	
	          </h:panelGrid>
          	<br/>
          <p:commandButton id="createSaveButton" ajax="false" value="#{messages.label_save}" action="#{relatorioMesBean.persist}"  onclick="createDialogfaturamentoWidget.hide()"  oncomplete="PF('createDialogfaturamentoWidget').hide()"  />
    	</fieldset>
    	</h:form>
    </p:dialog>    
    <p:ajaxStatus onstart="PF('statusDialog').show()" onsuccess="PF('statusDialog').hide()" />
	<p:dialog id="loading" widgetVar="statusDialog" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
	    <p:graphicImage name="/images/carregando.gif" />
	</p:dialog>
  </ui:define>
</ui:composition>
</html>